name: æ¯ 6 å°æ—¶è‡ªåŠ¨æ›´æ–° random_ips.txtï¼ˆç”Ÿæˆå¹¶ä¿å­˜åˆ°ä»“åº“ï¼‰

on:
  schedule:
    - cron: '0 */6 * * *'  # æ¯ 6 å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼ˆUTC æ—¶é—´ï¼‰
  workflow_dispatch:
    inputs:
      prefix:
        description: 'IP å‰ç¼€'
        required: false
        default: '172.64.229'

jobs:
  generate_ips:
    runs-on: ubuntu-latest

    steps:
      - name: æ£€å‡ºä»“åº“ä»£ç ï¼ˆå…è®¸æäº¤ä¿®æ”¹ï¼‰
        uses: actions/checkout@v3
        with:
          persist-credentials: true  # ä¿è¯ GitHub Token å¯ç”¨äºæäº¤

      - name: æ¸…ç©ºæ—§ IP å¹¶ç”Ÿæˆæ–° IP
        run: |
          PREFIX="${{ github.event.inputs.prefix }}"
          FILE="random_ips.txt"

          # å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”éç©ºï¼Œæ¸…ç©ºå†…å®¹
          if [ -s "$FILE" ]; then
            echo "æ£€æµ‹åˆ°æ—§ IPï¼Œå·²æ¸…ç©ºæ–‡ä»¶"
            > "$FILE"
          else
            echo "æ–‡ä»¶ä¸å­˜åœ¨æˆ–ä¸ºç©ºï¼Œåˆ›å»ºå¹¶å†™å…¥æ–° IP"
            touch "$FILE"
          fi

          # ç”Ÿæˆ 10 ä¸ªéšæœº IP
          for i in $(seq 1 10); do
            LAST=$(( (RANDOM % 200) + 1 ))
            echo "${PREFIX}.${LAST}" >> "$FILE"
          done

          echo "å®Œæˆå†™å…¥æ–° IP"

      - name: æ˜¾ç¤ºç”Ÿæˆçš„ IP å†…å®¹
        run: cat random_ips.txt

      - name: æäº¤å¹¶æ¨é€åˆ°ä»“åº“
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          if ! git diff --quiet; then
            git add random_ips.txt
            git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–° IP: $(date -u +'%Y-%m-%d %H:%M:%S')"
            git push
          else
            echo "æ–‡ä»¶æœªå˜åŒ–ï¼Œè·³è¿‡æäº¤ã€‚"